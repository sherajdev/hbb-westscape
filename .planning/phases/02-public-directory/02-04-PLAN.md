---
phase: 02-public-directory
plan: 04
type: execute
wave: 3
depends_on: ["02-02", "02-03"]
files_modified:
  - convex/businesses.ts
autonomous: false

must_haves:
  truths:
    - "Complete directory flow works end-to-end"
    - "Filtering updates URL and results"
    - "Cards link to correct profile pages"
    - "Contact modal displays correctly"
    - "UI is responsive on mobile and desktop"
  artifacts: []
  key_links: []
---

<objective>
Create test data and verify the complete public directory flow works end-to-end.

Purpose: Ensure all Phase 2 success criteria are met with real data before moving forward.
Output: Verified working directory with test businesses.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/02-public-directory/02-CONTEXT.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add test data seeding mutation</name>
  <files>convex/businesses.ts</files>
  <action>
Add a temporary mutation to seed test businesses for verification. This will be removed after testing.

Add to convex/businesses.ts:

```typescript
// TEMPORARY: Seed test businesses for Phase 2 verification
// Remove after testing is complete
export const seedTestBusinesses = mutation({
  args: {},
  handler: async (ctx) => {
    // Check if test businesses already exist
    const existing = await ctx.db
      .query("businesses")
      .withIndex("by_status", (q) => q.eq("status", "approved"))
      .first();

    if (existing) {
      return { message: "Test data already exists" };
    }

    // Create a test user first
    const testUserId = await ctx.db.insert("users", {
      clerkId: "test_clerk_id_seed",
      email: "test@example.com",
      name: "Test User",
      createdAt: Date.now(),
    });

    const now = Date.now();
    const thirtyOneDaysAgo = now - (31 * 24 * 60 * 60 * 1000);

    // Seed 4 test businesses (one per category)
    const testBusinesses = [
      {
        ownerId: testUserId,
        name: "Mama's Kitchen",
        category: "Food" as const,
        description: "Authentic home-cooked meals made with love. We specialize in traditional recipes passed down through generations. Our menu changes weekly based on fresh ingredients from local markets.",
        shortDescription: "Authentic home-cooked meals made with love. We specialize in traditional recipes passed down through gen...",
        address: "Block 123, #01-456, WestScape",
        status: "approved" as const,
        contactPhone: "+6591234567",
        contactWhatsApp: "+6591234567",
        contactInstagram: "https://instagram.com/mamaskitchen",
        createdAt: now, // New (within 30 days)
        updatedAt: now,
        approvedAt: now,
      },
      {
        ownerId: testUserId,
        name: "Glow Beauty Studio",
        category: "Beauty" as const,
        description: "Professional home-based beauty services including manicures, pedicures, lash extensions, and facial treatments. All products are cruelty-free and premium quality.",
        shortDescription: "Professional home-based beauty services including manicures, pedicures, lash extensions, and facial tre...",
        address: "Block 456, #02-789, WestScape",
        status: "approved" as const,
        contactPhone: "+6598765432",
        contactWhatsApp: "+6598765432",
        contactFacebook: "https://facebook.com/glowbeautystudio",
        createdAt: thirtyOneDaysAgo, // Not new (older than 30 days)
        updatedAt: now,
        approvedAt: now,
      },
      {
        ownerId: testUserId,
        name: "Fusion Delights",
        category: "Fusion" as const,
        description: "Creative fusion cuisine blending Asian and Western flavors. From Korean tacos to Japanese-Italian pasta, we love experimenting with unique flavor combinations.",
        shortDescription: "Creative fusion cuisine blending Asian and Western flavors. From Korean tacos to Japanese-Italian past...",
        address: "Block 789, #03-012, WestScape",
        status: "approved" as const,
        contactWhatsApp: "+6555551234",
        contactTikTok: "https://tiktok.com/@fusiondelights",
        contactWebsite: "https://fusiondelights.com",
        createdAt: now,
        updatedAt: now,
        approvedAt: now,
      },
      {
        ownerId: testUserId,
        name: "HandyFix Services",
        category: "Services" as const,
        description: "Reliable handyman services for your home. We handle electrical work, plumbing, furniture assembly, aircon servicing, and general repairs. Fast response and fair pricing.",
        shortDescription: "Reliable handyman services for your home. We handle electrical work, plumbing, furniture assembly, air...",
        address: "Block 321, #04-567, WestScape",
        status: "approved" as const,
        contactPhone: "+6512345678",
        contactCarousell: "https://carousell.com/handyfix",
        createdAt: thirtyOneDaysAgo,
        updatedAt: now,
        approvedAt: now,
      },
    ];

    for (const business of testBusinesses) {
      await ctx.db.insert("businesses", business);
    }

    return { message: "Created 4 test businesses" };
  },
});
```

This creates:
- 2 "New" businesses (Food, Fusion - created now)
- 2 older businesses (Beauty, Services - created 31 days ago)
- Different contact link combinations for testing modal
  </action>
  <verify>
Run `npx convex dev` to push the new mutation.
  </verify>
  <done>
seedTestBusinesses mutation is available in Convex dashboard.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete public directory with:
- Directory page at /directory with category filtering
- Business cards with "New" badge for recent listings
- Business profile pages at /business/[id]
- Contact modal with icon-based links
- Test data seeding mutation
  </what-built>
  <how-to-verify>
1. Start the dev servers if not running:
   - Terminal 1: `npx convex dev`
   - Terminal 2: `npm run dev`

2. Seed test data:
   - Go to Convex dashboard (link in convex dev output)
   - Navigate to Functions tab
   - Find and run `businesses:seedTestBusinesses`
   - Should see "Created 4 test businesses" result

3. Test directory page:
   - Visit http://localhost:3000/directory
   - Verify: 4 business cards displayed
   - Verify: "New" badge appears on Mama's Kitchen and Fusion Delights (not on Glow Beauty or HandyFix)
   - Verify: Cards show name, category badge, short description

4. Test category filtering:
   - Click "Food" filter - only Mama's Kitchen shows
   - Click "Beauty" filter - only Glow Beauty Studio shows
   - Click "All" filter - all 4 businesses show
   - Verify: URL updates (?category=Food, etc.)
   - Verify: Browser back/forward works with filters

5. Test profile page:
   - Click on Mama's Kitchen card
   - Verify: URL is /business/{id}
   - Verify: Full description displayed
   - Verify: "Photos" section shows placeholder (no images in test data)
   - Verify: Contact button visible

6. Test contact modal:
   - Click "Contact" button
   - Verify: Modal opens with Phone and WhatsApp links (and Instagram for Mama's)
   - Verify: Icons display correctly
   - Click backdrop or X - modal should close

7. Test another profile (Fusion Delights):
   - Verify: Different contact links (WhatsApp, TikTok, Website)

8. Test responsive design:
   - Use browser dev tools to simulate mobile viewport
   - Verify: Cards stack in single column on mobile
   - Verify: Filter pills are scrollable horizontally if needed
   - Verify: Modal is usable on mobile

9. Test 404 handling:
   - Visit http://localhost:3000/business/invalid-id
   - Should show Next.js 404 page
  </how-to-verify>
  <resume-signal>
Type "approved" if all checks pass.
If issues found, describe what needs fixing.
  </resume-signal>
</task>

</tasks>

<verification>
Human verification of complete flow.
</verification>

<success_criteria>
All Phase 2 success criteria verified:
1. Visitor can view list of approved businesses without login
2. Visitor can filter businesses by category
3. Business cards display name, category, short description, and "New" badge
4. Visitor can click into a business profile and see full details, photos, video
5. Visitor can click Contact button and see modal with contact links
</success_criteria>

<output>
After completion, create `.planning/phases/02-public-directory/02-04-SUMMARY.md`
</output>
