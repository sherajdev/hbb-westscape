---
phase: 02-public-directory
plan: 02
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - components/directory/BusinessCard.tsx
  - components/directory/CategoryFilter.tsx
  - components/directory/BusinessGrid.tsx
  - app/directory/page.tsx
autonomous: true

must_haves:
  truths:
    - "Visitor sees list of approved businesses without login"
    - "Visitor can filter businesses by category"
    - "Business cards show name, category badge, short description"
    - "New badge appears on businesses registered within 30 days"
    - "Clicking a card navigates to business profile"
  artifacts:
    - path: "app/directory/page.tsx"
      provides: "Public directory page with Server Component"
      min_lines: 30
    - path: "components/directory/BusinessCard.tsx"
      provides: "Business card with New badge logic"
      contains: "isNew"
    - path: "components/directory/CategoryFilter.tsx"
      provides: "Category filter pills with URL state"
      contains: "use client"
    - path: "components/directory/BusinessGrid.tsx"
      provides: "Responsive grid layout"
      contains: "grid-cols"
  key_links:
    - from: "app/directory/page.tsx"
      to: "api.businesses.listApprovedBusinesses"
      via: "fetchQuery"
      pattern: "fetchQuery.*listApprovedBusinesses"
    - from: "components/directory/CategoryFilter.tsx"
      to: "URL searchParams"
      via: "useSearchParams and router.push"
      pattern: "useSearchParams"
    - from: "components/directory/BusinessCard.tsx"
      to: "/business/[id]"
      via: "Link component"
      pattern: "href=.*business"
---

<objective>
Create the public directory page with business cards and category filtering.

Purpose: Visitors can browse approved businesses without login, filter by category, and click through to profiles.
Output: Working /directory page with responsive grid, category filter, and business cards.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/02-public-directory/02-RESEARCH.md
@.planning/phases/02-public-directory/02-CONTEXT.md

# API reference
@convex/businesses.ts
@convex/schema.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create directory components</name>
  <files>
    components/directory/BusinessCard.tsx
    components/directory/CategoryFilter.tsx
    components/directory/BusinessGrid.tsx
  </files>
  <action>
Create three components in components/directory/:

**1. BusinessCard.tsx (Server Component - no "use client"):**
- Props: business object with _id, name, category, shortDescription, createdAt, imageUrls (optional)
- Display:
  - Image placeholder or first image if available (use Next.js Image, fallback to gray div with icon)
  - "New" badge if createdAt is within 30 days (Date.now() - 30*24*60*60*1000)
  - Business name (h3)
  - Category badge (colored pill - Food: orange, Beauty: pink, Fusion: purple, Services: blue)
  - Short description (truncated to 2 lines with line-clamp-2)
- Wrap entire card in Next.js Link to /business/{business._id}
- Styling: rounded-lg, shadow-sm, hover:shadow-md transition, p-4

Helper function for New badge:
```typescript
function isNew(createdAt: number): boolean {
  const thirtyDaysAgo = Date.now() - (30 * 24 * 60 * 60 * 1000);
  return createdAt > thirtyDaysAgo;
}
```

**2. CategoryFilter.tsx (Client Component - "use client"):**
- No props needed (reads from URL)
- Categories: ["All", "Food", "Beauty", "Fusion", "Services"]
- Use useSearchParams() to get current category (default "All")
- Use useRouter() to update URL on click
- Display horizontal row of pill buttons
- Active state: bg-slate-900 text-white
- Inactive state: bg-slate-100 text-slate-700 hover:bg-slate-200
- On click: router.push("/directory") for All, router.push("/directory?category=X") for others

**3. BusinessGrid.tsx (Server Component):**
- Props: businesses array
- Display responsive grid: grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6
- Map over businesses rendering BusinessCard for each
- Handle empty state: "No businesses found" message
  </action>
  <verify>
Run `npx tsc --noEmit` to check for TypeScript errors.
  </verify>
  <done>
Three components exist in components/directory/ with correct structure.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create directory page</name>
  <files>app/directory/page.tsx</files>
  <action>
Create app/directory/page.tsx as a Server Component:

```typescript
import { fetchQuery } from "convex/nextjs";
import { api } from "@/convex/_generated/api";
import CategoryFilter from "@/components/directory/CategoryFilter";
import BusinessGrid from "@/components/directory/BusinessGrid";

type SearchParams = Promise<{ category?: string }>;

export default async function DirectoryPage({
  searchParams,
}: {
  searchParams: SearchParams;
}) {
  const { category } = await searchParams;

  // Validate category
  const validCategories = ["Food", "Beauty", "Fusion", "Services"] as const;
  const selectedCategory = validCategories.includes(category as any)
    ? (category as typeof validCategories[number])
    : undefined;

  // Fetch approved businesses
  const businesses = await fetchQuery(api.businesses.listApprovedBusinesses, {
    category: selectedCategory,
  });

  return (
    <main className="container mx-auto px-4 py-8">
      <h1 className="text-3xl font-bold mb-6">Business Directory</h1>
      <CategoryFilter />
      <div className="mt-6">
        <BusinessGrid businesses={businesses} />
      </div>
    </main>
  );
}
```

Key points:
- Await searchParams (Next.js 16 pattern)
- Validate category against allowed values
- Pass validated category to Convex query
- Server-side data fetching (no useQuery)
  </action>
  <verify>
Visit http://localhost:3000/directory (with dev server running).
Page should render without errors (may be empty if no approved businesses).
  </verify>
  <done>
/directory page renders with category filter and business grid.
  </done>
</task>

</tasks>

<verification>
After all tasks:
1. `npx tsc --noEmit` passes
2. http://localhost:3000/directory loads without errors
3. Category filter buttons are visible and clickable
4. URL updates when clicking category filters
5. Empty state shows "No businesses found" (expected if no approved businesses)
</verification>

<success_criteria>
- Directory page exists at /directory
- Category filter syncs with URL params
- Business cards display with proper styling
- New badge logic implemented for 30-day window
- Grid is responsive across breakpoints
</success_criteria>

<output>
After completion, create `.planning/phases/02-public-directory/02-02-SUMMARY.md`
</output>
