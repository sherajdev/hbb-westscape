---
phase: 02-public-directory
plan: 03
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - components/business/ContactModal.tsx
  - components/business/PhotoGallery.tsx
  - components/business/VideoPlayer.tsx
  - app/business/[businessId]/page.tsx
autonomous: true

must_haves:
  truths:
    - "Visitor can view business profile without login"
    - "Profile shows name, category, full description"
    - "Profile shows photo gallery if images exist"
    - "Profile shows video if video exists"
    - "Contact button opens modal with contact links"
    - "Modal displays icon-based links for all contact types"
  artifacts:
    - path: "app/business/[businessId]/page.tsx"
      provides: "Dynamic business profile page"
      min_lines: 40
    - path: "components/business/ContactModal.tsx"
      provides: "Contact modal with all link types"
      contains: "dialog"
    - path: "components/business/PhotoGallery.tsx"
      provides: "Image gallery display"
      contains: "Image"
    - path: "components/business/VideoPlayer.tsx"
      provides: "Video display component"
  key_links:
    - from: "app/business/[businessId]/page.tsx"
      to: "api.businesses.getBusinessWithImages"
      via: "fetchQuery"
      pattern: "fetchQuery.*getBusinessWithImages"
    - from: "components/business/ContactModal.tsx"
      to: "lucide-react"
      via: "icon imports"
      pattern: "from.*lucide-react"
    - from: "components/business/ContactModal.tsx"
      to: "WhatsApp API"
      via: "wa.me URL"
      pattern: "wa\\.me"
---

<objective>
Create the business profile page with photo gallery, video player, and contact modal.

Purpose: Visitors can view full business details and access contact information via modal.
Output: Working /business/[id] profile page with all content sections and contact modal.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/02-public-directory/02-RESEARCH.md
@.planning/phases/02-public-directory/02-CONTEXT.md

# API reference
@convex/businesses.ts
@convex/schema.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create profile page components</name>
  <files>
    components/business/ContactModal.tsx
    components/business/PhotoGallery.tsx
    components/business/VideoPlayer.tsx
  </files>
  <action>
Create three components in components/business/:

**1. ContactModal.tsx (Client Component - "use client"):**
- Props: contactInfo object with optional fields: phone, whatsapp, instagram, tiktok, facebook, carousell, website
- Use native HTML5 `<dialog>` element (not a library)
- Use useRef for dialog element
- Trigger button: "Contact" with primary styling
- Modal content:
  - Header: "Contact Us" with X close button
  - List of contact links (only render if value exists):
    - Phone: Phone icon, "Call", href=`tel:${phone}`
    - WhatsApp: MessageCircle icon, "WhatsApp", href=`https://wa.me/${phone.replace(/[^0-9]/g, '')}`
    - Instagram: Instagram icon, "Instagram", target="_blank"
    - TikTok: Music icon, "TikTok", target="_blank"
    - Facebook: Facebook icon, "Facebook", target="_blank"
    - Carousell: ShoppingBag icon, "Carousell", target="_blank"
    - Website: Globe icon, "Website", target="_blank"
  - Each link: flex row with icon (24px), label, hover:bg-slate-50
- Close on backdrop click (check if e.target === dialogRef.current)
- Close on X button click
- Import icons from lucide-react

**2. PhotoGallery.tsx (Server Component):**
- Props: imageUrls string array
- If no images: render placeholder with ImageIcon and "No photos yet" text
- If images exist: responsive grid (grid-cols-2 md:grid-cols-3 gap-4)
- Use Next.js Image component with fill, object-cover
- Container needs relative positioning and aspect ratio
- Alt text: "Business photo {index + 1}"

**3. VideoPlayer.tsx (Client Component - "use client"):**
- Props: videoUrl string | null
- If no video: return null (don't render anything)
- Use native HTML5 `<video>` element (simpler than react-player for local files)
- Video attributes: controls, className for responsive width
- Poster: first frame (browser default)
- Wrapper: max-w-3xl mx-auto for centering
  </action>
  <verify>
Run `npx tsc --noEmit` to check for TypeScript errors.
  </verify>
  <done>
Three components exist in components/business/ with correct structure.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create business profile page</name>
  <files>app/business/[businessId]/page.tsx</files>
  <action>
Create app/business/[businessId]/page.tsx as a Server Component:

```typescript
import { fetchQuery } from "convex/nextjs";
import { api } from "@/convex/_generated/api";
import { Id } from "@/convex/_generated/dataModel";
import { notFound } from "next/navigation";
import Link from "next/link";
import { ArrowLeft } from "lucide-react";
import ContactModal from "@/components/business/ContactModal";
import PhotoGallery from "@/components/business/PhotoGallery";
import VideoPlayer from "@/components/business/VideoPlayer";

type Params = Promise<{ businessId: string }>;

export default async function BusinessPage({ params }: { params: Params }) {
  const { businessId } = await params;

  const business = await fetchQuery(api.businesses.getBusinessWithImages, {
    businessId: businessId as Id<"businesses">,
  });

  if (!business) {
    notFound();
  }

  // Build contact info object
  const contactInfo = {
    phone: business.contactPhone,
    whatsapp: business.contactWhatsApp,
    instagram: business.contactInstagram,
    tiktok: business.contactTikTok,
    facebook: business.contactFacebook,
    carousell: business.contactCarousell,
    website: business.contactWebsite,
  };

  // Check if business has any contact info
  const hasContact = Object.values(contactInfo).some(Boolean);

  return (
    <main className="container mx-auto px-4 py-8">
      {/* Back link */}
      <Link
        href="/directory"
        className="inline-flex items-center gap-2 text-slate-600 hover:text-slate-900 mb-6"
      >
        <ArrowLeft size={20} />
        Back to Directory
      </Link>

      {/* Header section */}
      <div className="mb-8">
        <div className="flex items-start justify-between flex-wrap gap-4">
          <div>
            <h1 className="text-3xl font-bold">{business.name}</h1>
            <span className="inline-block mt-2 px-3 py-1 rounded-full text-sm font-medium bg-slate-100">
              {business.category}
            </span>
          </div>
          {hasContact && <ContactModal contactInfo={contactInfo} />}
        </div>
        <p className="mt-4 text-slate-600">{business.address}</p>
      </div>

      {/* Description */}
      <section className="mb-8">
        <h2 className="text-xl font-semibold mb-3">About</h2>
        <p className="text-slate-700 whitespace-pre-wrap">{business.description}</p>
      </section>

      {/* Photo gallery */}
      <section className="mb-8">
        <h2 className="text-xl font-semibold mb-3">Photos</h2>
        <PhotoGallery imageUrls={business.imageUrls || []} />
      </section>

      {/* Video */}
      {business.videoUrl && (
        <section className="mb-8">
          <h2 className="text-xl font-semibold mb-3">Video</h2>
          <VideoPlayer videoUrl={business.videoUrl} />
        </section>
      )}
    </main>
  );
}
```

Key points:
- Await params (Next.js 16 pattern)
- Cast businessId to Id<"businesses"> for Convex
- Use notFound() for missing/unapproved businesses
- Conditionally render Contact modal only if has contact info
- Conditionally render Video section only if videoUrl exists
  </action>
  <verify>
Visit http://localhost:3000/business/{some-id} (will show 404 without valid business).
Check that page structure renders correctly if a test business exists.
  </verify>
  <done>
/business/[businessId] page renders with all sections.
  </done>
</task>

</tasks>

<verification>
After all tasks:
1. `npx tsc --noEmit` passes
2. http://localhost:3000/business/invalid-id shows 404 page
3. Profile page layout has all sections: header, about, photos, video
4. Contact modal opens when Contact button clicked
5. Modal closes on backdrop click or X button
</verification>

<success_criteria>
- Profile page exists at /business/[businessId]
- Page shows business name, category, address, description
- Photo gallery renders (or shows placeholder)
- Video player renders if video exists
- Contact modal opens with icon-based links
- WhatsApp URL properly formatted (digits only)
</success_criteria>

<output>
After completion, create `.planning/phases/02-public-directory/02-03-SUMMARY.md`
</output>
